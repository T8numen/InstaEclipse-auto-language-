# InstaEclipse 中英汉化实施方案（含手机语言自动切换）

## 1. 目标
- 将 Instagram 内注入弹窗与提示文案改为可国际化资源，不再硬编码英文。
- 支持根据手机语言自动显示中文或英文（中文优先 `zh-rCN` / `zh-rTW`，其余回退英文）。
- 保持现有功能逻辑不变，仅改文案来源与读取方式。

## 2. 现状结论（已定位）
- 你现有的 `5.2thinking汉化方案.md` 方向是正确的，核心问题判断准确：`DialogUtils` 在宿主进程（Instagram）里运行，硬编码文案不会自动中文化。
- 目前硬编码用户文案主要分布在以下文件：
  - `app/src/main/java/ps/reso/instaeclipse/utils/dialog/DialogUtils.java`
  - `app/src/main/java/ps/reso/instaeclipse/utils/ghost/GhostModeUtils.java`
  - `app/src/main/java/ps/reso/instaeclipse/mods/ui/UIHookManager.java`
  - `app/src/main/java/ps/reso/instaeclipse/utils/version/VersionCheckUtility.java`
  - `app/src/main/java/ps/reso/instaeclipse/mods/devops/config/ConfigManager.java`
  - `app/src/main/java/ps/reso/instaeclipse/mods/devops/config/JsonImportActivity.java`
  - `app/src/main/java/ps/reso/instaeclipse/mods/devops/config/JsonExportActivity.java`

## 3. 方案决策
- 采用你现有方案的核心思路：将硬编码文案迁移到 `strings.xml`，并在宿主进程中通过模块资源读取。
- 在此基础上补充两点：
  - 不只改 `DialogUtils`，把所有用户可见 Toast/Dialog 一并收敛到资源，避免“半汉化”。
  - 新增统一 `I18n` 工具，避免每个类重复写 `createPackageContext`。

## 4. 技术设计

### 4.1 新增统一国际化工具类
建议新增：
- `app/src/main/java/ps/reso/instaeclipse/utils/i18n/I18n.java`

职责：
- 获取模块上下文（`createPackageContext(CommonUtils.MY_PACKAGE_NAME, ...)`）。
- 按手机系统语言创建本地化配置上下文后再 `getString()`。
- 统一提供：
  - `I18n.t(Context hostContext, @StringRes int id, Object... args)`（返回文案）
  - `I18n.toast(Context hostContext, @StringRes int id, int duration, Object... args)`（可选）

### 4.2 语言选择策略（满足“按手机语言切换”）
- 读取手机语言：`Resources.getSystem().getConfiguration().getLocales().get(0)`。
- 规则：
  - `zh-CN`、`zh-SG` -> 简中资源（`values-zh-rCN`）
  - `zh-TW`、`zh-HK`、`zh-MO` -> 繁中资源（`values-zh-rTW`）
  - 其他 -> 英文默认（`values/strings.xml`）

说明：
- 这样会“跟手机语言”，不受 Instagram App 内单独语言设置影响。

## 5. 实施步骤（建议顺序）

### 第 1 步（必做）：弹窗主链路汉化
- 修改 `DialogUtils.java`，把所有英文硬编码替换为 `I18n.t(...)`。
- 包含：
  - 主菜单标题/分组/按钮
  - 各开关文案
  - 二级弹窗（Extreme Mode 确认、错误提示、重启提示）
  - Back/Close/OK/Cancel/Yes 等按钮

建议：
- `"OK"`, `"Cancel"`, `"Yes"` 可优先用 `android.R.string.ok/cancel/yes`，减少维护量。

### 第 2 步（必做）：宿主进程 Toast 文案汉化
- 修改：
  - `GhostModeUtils.java`
  - `UIHookManager.java`
  - `ConfigManager.java`
- 将所有 `Toast.makeText(..., "英文文本", ...)` 改为资源文案。

### 第 3 步（建议）：模块进程中的对话框/导入导出提示汉化
- 修改：
  - `VersionCheckUtility.java`
  - `JsonImportActivity.java`
  - `JsonExportActivity.java`
- 这些在模块自身进程里运行，可直接 `getString(R.string.xxx)`。

### 第 4 步（必做）：补全资源键
- 在 `values/strings.xml` 中新增英文键（默认回退语言）。
- 在 `values-zh-rCN/strings.xml` 中新增简中键。
- 在 `values-zh-rTW/strings.xml` 中新增繁中键（建议同步补全）。
- 键命名建议：
  - `ig_dialog_*`：注入弹窗
  - `ig_toast_*`：注入 Toast
  - `ig_update_*`：版本检查弹窗
  - `ig_config_*`：导入导出相关

## 6. 文案覆盖清单（最小可用）
- 主弹窗：主菜单、二级页面标题、Back/Close。
- 功能开关：Ghost / Ads / Distraction-Free / Misc 全部 switch 文案。
- 结果提示：导入成功/失败、重启失败、Ghost 模式开关状态、消息已标记已读等。
- 版本检查：更新可用、稍后、检查失败。

## 7. 验收标准
- 手机语言为简体中文时：注入弹窗与提示全部中文。
- 手机语言为英文时：注入弹窗与提示全部英文。
- 切换系统语言后重启 Instagram：文案随语言变化。
- 不出现崩溃、不影响原有 Hook 行为。

## 8. 回归测试建议
- 路径测试：
  - 主弹窗 7 个入口全部点击一遍。
  - Ghost 快捷切换、Extreme Mode 确认弹窗。
  - Import/Export 成功与失败分支。
  - 重启功能成功与失败分支。
- 兼容测试：
  - Instagram 官方包与常见克隆包至少各测 1 个。

## 9. 风险与规避
- 风险：在宿主进程直接 `context.getString()` 可能拿到 Instagram 资源，导致 key 不存在。
- 规避：统一走 `I18n` 工具中的“模块上下文 + 本地化上下文”读取。

## 10. 结论
- 你的现有方案可直接采用，建议升级为“统一 I18n 工具 + 全量用户文案迁移”版本。
- 这样可以一次性解决注入弹窗汉化问题，并长期支持中英自动切换，后续新增文案也不会再回到硬编码模式。
